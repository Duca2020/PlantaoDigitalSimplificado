<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <title>Template básico</title>
  <!-- Fonte Rawline-->
  <link rel="stylesheet" href="https://cdngovbr-ds.estaleiro.serpro.gov.br/design-system/fonts/rawline/css/rawline.css"/>
  <!-- Fonte Raleway-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:300,400,500,600,700,800,900&amp;display=swap"/>
  <!-- Design System de Governo-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@govbr-ds/core/dist/core.css" />
  <!-- Fontawesome-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"/>
  <!-- jpreadsheet-->
  <link rel="stylesheet" href="https://jsuites.net/v5/jsuites.css" type="text/css" />
  <link rel="stylesheet" href="https://bossanova.uk/jspreadsheet/v5/jspreadsheet.css" type="text/css" />
  <!-- icones google-->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons" type="text/css" />
  <!-- jsPDF e jspdf-autotable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <!-- SheetJS-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</head>
<body>
<div class="template-base">
  <nav class="br-skiplink" role="menubar"><a class="br-item" href="#main-content" role="menuitem" accesskey="1">Ir para o conteúdo <span aria-hidden="true">(1/4)</span> <span aria-hidden="true" class="br-tag text ml-1">1</span></a><a class="br-item" href="#header-navigation" role="menuitem" accesskey="2">Ir para o menu <span aria-hidden="true">(2/4)</span> <span aria-hidden="true" class="br-tag text ml-1">2</span></a><a class="br-item" href="#main-searchbox" role="menuitem" accesskey="3">Ir para a busca <span aria-hidden="true">(3/4)</span> <span aria-hidden="true" class="br-tag text ml-1">3</span></a><a class="br-item" href="#footer" role="menuitem" accesskey="4">Ir para o rodapé <span aria-hidden="true">(4/4)</span> <span aria-hidden="true" class="br-tag text ml-1">4</span></a>
  </nav>
  <header class="br-header mb-4" id="header" data-sticky="data-sticky">
    <div class="container-lg">
      <div class="header-top">
        <div class="header-logo"><img class="brasaoImg" src="" alt="logo"/><span class="br-divider vertical"></span>
          <div class="header-sign">
            <a href="https://pmt.pi.gov.br/" style="color: #1351B4; text-decoration: none; font-size: 20px;" target="_blank">Prefeitura de Teresina</a>
          </div>
        </div>
        <div class="header-actions">
          <div class="header-links dropdown">
            <button class="br-button circle small" type="button" data-toggle="dropdown" aria-label="Abrir Acesso Rápido"><i class="fas fa-ellipsis-v" aria-hidden="true"></i>
            </button>
            <div class="br-list">
              <div class="header">
                <div class="title">Acesso Rápido</div>
              </div><a class="br-item" href="https://pmt.pi.gov.br/secretarios/">Órgãos da Prefeitura</a><a class="br-item" href="https://pmt.pi.gov.br/teresinensedigital/">Acesso à Informação</a><a class="br-item" href="http://legislacao.teresina.pi.gov.br/legislacao.php">Legislação</a><a class="br-item" href="http://ouvidoria.teresina.pi.gov.br/">Contato</a>
            </div>
          </div><span class="br-divider vertical mx-half mx-sm-1"></span>
          <div class="header-functions dropdown">
            <button class="br-button circle small" type="button" data-toggle="dropdown" aria-label="Abrir Funcionalidades do Sistema"><i class="fas fa-th" aria-hidden="true"></i>
            </button>
            <div class="br-list">
              <div class="header">
                <div class="title">Funcionalidades do Sistema</div>
              </div>
              <div class="br-item">
                <button class="br-button circle small" type="button" aria-label="Funcionalidade 1"><i class="fas fa-chart-bar" aria-hidden="true"></i><span class="text">Funcionalidade 1</span>
                </button>
              </div>
              <div class="br-item">
                <button class="br-button circle small" type="button" aria-label="Funcionalidade 2"><i class="fas fa-headset" aria-hidden="true"></i><span class="text">Funcionalidade 2</span>
                </button>
              </div>
              <div class="br-item">
                <button class="br-button circle small" type="button" aria-label="Funcionalidade 3"><i class="fas fa-comment" aria-hidden="true"></i><span class="text">Funcionalidade 3</span>
                </button>
              </div>
              <div class="br-item">
                <button class="br-button circle small" type="button" aria-label="Funcionalidade 4"><i class="fas fa-adjust" aria-hidden="true"></i><span class="text">Funcionalidade 4</span>
                </button>
              </div>
            </div>
          </div>
          <div class="header-search-trigger">
            <button class="br-button circle" type="button" aria-label="Abrir Busca" data-toggle="search" data-target=".header-search"><i class="fas fa-search" aria-hidden="true"></i>
            </button>
          </div>

        </div>
      </div>
      <div class="header-bottom">
        <div class="header-menu">
          <div class="header-menu-trigger" id="header-navigation">
            <button class="br-button small circle" type="button" aria-label="Menu" data-toggle="menu" data-target="#main-navigation" id="navigation"><i class="fas fa-bars" aria-hidden="true"></i>
            </button>
          </div>
          <div class="header-info">
            <div class="header-title">Plantão Funerário</div>
          </div>
        </div>
        <div class="header-search" id="main-searchbox">
          <div class="br-input has-icon">
            <label for="searchbox">Texto da pesquisa</label>
            <input id="searchbox" type="text" placeholder="O que você procura?"/>
            <button class="br-button circle small" type="button" aria-label="Pesquisar"><i class="fas fa-search" aria-hidden="true"></i>
            </button>
          </div>
          <button class="br-button circle search-close ml-1" type="button" aria-label="Fechar Busca" data-dismiss="search"><i class="fas fa-times" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>
  </header>
  <main class="d-flex flex-fill mb-5" id="main">
    <div class="container-lg d-flex">
      <div class="row">
        <div class="br-menu" id="main-navigation">
          <div class="menu-container">
            <div class="menu-panel">
              <div class="menu-header">
                <div class="menu-title">
                  <img class="brasaoImg" src="" alt="Imagem ilustrativa"/>
                  <span style="font-size: 20px;">Usuário Interno</span>
                </div>
                <div class="menu-close">
                  <button class="br-button circle" type="button" aria-label="Fechar o menu" data-dismiss="menu"><i class="fas fa-times" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
              <nav class="menu-body" role="tree">
                <a class="menu-item divider" href="gerar_documentos.html" role="treeitem"><span class="icon"><i class="fas fa-bell" aria-hidden="true"></i></span><span class="content">Gerar Documentos</span></a>
                <a class="menu-item divider" href="../FAQ.html" role="treeitem"><span class="icon"><i class="fas fa-bell" aria-hidden="true"></i></span><span class="content">Ajuda</span></a>
              </nav>
            </div>
            <div class="menu-scrim" data-dismiss="menu" tabindex="0"></div>
          </div>
        </div>

        <div class="col mb-5">
          <nav class="br-breadcrumb">
            <ol class="crumb-list" role="list">
              <li class="crumb home"><a class="br-button circle"><span class="sr-only">Página inicial</span><i class="fas fa-home"></i></a></li>
              <li class="crumb"><i class="icon fas fa-chevron-right"></i>Gerar Documentos</li>
            </ol>
          </nav>
          <div class="main-content pl-sm-3 mt-4" id="main-content">
            <!--
            A funcionalidade abaixo é apenas uma placeholder.
            -> Deve-se criar uma tabela placeholder no computador (o próprio algoritmo cria ela e também sobrescreve caso tenham tentado
            salvar nela algo, isso evita uma super lotação de arquivos no computador e diminui a complexidade da tarefa de gerar relatorios);
            -> Essa tabela vai receber os dados da tabela original, bastando apenas copiar e colar os dados (precisamos definir apenas a ordem
            das colunas prefixadas);
            -> Adicionar o visor e notificação de que a tabela preenchida está sendo utilizada para os relatórios (pode deixar uma caixa pré-selecionada
            que não permite enviar arquivos de tabela para o algoritmo, exceto quando estiver desmarcada);
            -> Além da previsão da tabela, fazer a previsao do relatório da FMS/SDU igual no GOV; [Menos importante essa parte]
            -->

            <h1>Tabela de Dados</h1>
            <p>Esta poderá ser usada como base para gerar os relatórios FMS e SDU-Centro.</p>
            <div class="row">
              <div class="jss_toolbar jtoolbar" role="toolbar" data-role="toolbar" aria-label="Spreadsheet Tools">
                <div>
                  <div class="jtoolbar-item" id="saveBtn" title="Salvar como XLSX"><i class="material-icons">save</i></div>
                </div>
              </div>

              <div id="spreadsheet"></div>
            </div>
            <br><br><br><br><br><br><br>
            <h1>Gerar Relatório FMS (por tabela)</h1>
            <p>Esta funcionalidade é utilizada para gerar o relatório da FMS a partir de tabelas salvas no computador.</p>
            <div class="row">
              <div class="col-md-6">
                <div class="br-upload">
                  <label class="upload-label" for="fms-excel-upload"><span>Selecione o arquivo Excel de tabelas</span></label>
                  <input class="upload-input" id="fms-excel-upload" type="file" accept=".xlsx, .xls" aria-label="enviar arquivo Excel"/>
                  <div class="upload-list"></div>
                </div>
                <button class="br-button secondary mt-3" type="button" id="retornarFMS">Voltar
                </button>
                <button id="gerar-relatorio-fms-tabelas" class="br-button primary mt-3">Gerar Relatório FMS</button>
              </div>
            </div>
            <br><br><br><br><br><br><br>
            <h1>Gerar Relatório SDU-CENTRO (por tabela)</h1>
            <p>Esta funcionalidade é utilizada para gerar o relatório quinzenal da SDU-CENTRO a partir de tabelas salvas no computador.</p>
            <div class="row">
              <div class="col-md-6">
                <div class="br-upload">
                  <label class="upload-label" for="sdu-excel-upload"><span>Selecione o arquivo Excel de tabelas</span></label>
                  <input class="upload-input" id="sdu-excel-upload" type="file" multiple accept=".xlsx, .xls" aria-label="enviar arquivo Excel"/>
                  <div class="upload-list"></div>
                </div>
                <button class="br-button secondary mt-3" type="button" id="retornarSDU">Voltar
                </button>
                <button id="gerar-relatorio-sdu-tabelas" class="br-button primary mt-3">Gerar Relatório SDU-CENTRO</button>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </main>
  <footer class="br-footer pt-3" id="footer">
    <div class="container-lg">
      <div class="info">
        <div class="text-down-01 text-medium pb-3">Todo o conteúdo deste site está publicado sob a licença&nbsp;<strong><a href="https://creativecommons.org/licenses/by-nd/3.0/deed.en">Creative Commons Atribuição-SemDerivações 3.0 Não Adaptada</a>.</strong></div>
      </div>
    </div>
  </footer>
</div>

<script src="https://jsuites.net/v5/jsuites.js"></script>
<script src="https://bossanova.uk/jspreadsheet/v5/jspreadsheet.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/@govbr-ds/core/dist/core-init.js"></script>
<script type="module">
  import { loadImageAsBase64,readExcelFile, gerarRelatorioFmsPDF, gerarRelatorioSduPDF } from '../GeracaoArquivos/GerarArquivos.js';

  let spreadsheet = jspreadsheet(document.getElementById('spreadsheet'), {
    worksheets: [{
      data: Array(30).fill().map(() => ['', '', '', '', '', '', '', '', '', '']),
      columns: [
        { title: 'A' },
        { title: 'B' },
        { title: 'C' },
        { title: 'D' },
        { title: 'E' },
        { title: 'F' },
        { title: 'G' },
        { title: 'H' },
        { title: 'I' },
        { title: 'J' }
      ],
      tableOverflow: true,
      tableHeight: '400px',
      tableWidth: '800px',
      defaultColWidth: '100px',
      allowUndo: true
    }]
  });

  function download(sheet) {
    const data = sheet[0].getData();
    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
    XLSX.writeFile(wb, "arquivo.xlsx");
  }

  document.getElementById('undoBtn').onclick = () => spreadsheet.undo();
  document.getElementById('redoBtn').onclick = () => spreadsheet.redo();
  document.getElementById('saveBtn').onclick = () => download(spreadsheet);


  // URL da imagem
  const PMTbrasaoUrl = "https://i.imgur.com/HaGCfsJ.png";

  // Carregar a imagem ao iniciar a página
  window.onload = async () => {
    const base64String = await loadImageAsBase64(PMTbrasaoUrl);
    if (base64String) {
      // Selecionar todos os elementos com a classe brasaoImg
      const images = document.getElementsByClassName('brasaoImg');
      for (let img of images) {
        img.src = base64String;
      }
    }
// Evento para gerar relatório FMS a partir de Excel
    const excelInput = document.getElementById('fms-excel-upload');
    const gerarFmsButton = document.getElementById('gerar-relatorio-fms-tabelas');
    if (excelInput && gerarFmsButton) {
      gerarFmsButton.addEventListener('click', async () => {
        const file = excelInput.files[0];
        if (!file) {
          alert("Por favor, selecione um arquivo Excel.");
          return;
        }
        const data = await readExcelFile(file);
        if (data) {
          try {
            await gerarRelatorioFmsPDF(data);
            alert("Relatório FMS gerado com sucesso!");
          } catch (error) {
            console.error("Erro ao gerar o relatório FMS:", error);
            alert("Ocorreu um erro ao gerar o relatório.");
          }
        }
      });
    } else {
      console.error("Elemento com ID 'fms-excel-upload' ou 'gerar-relatorio-fms' não encontrado no DOM.");
    }


    // Evento para o botão Voltar FMS
    const voltarButtonFMS = document.getElementById('retornarFMS');
    if (voltarButtonFMS) {
      voltarButtonFMS.addEventListener('click', () => {
        window.location.href = 'home.html';
      });
    } else {
      console.error("Elemento com ID 'retornarFMS' não encontrado no DOM.");
    }

    // Evento para gerar relatório SDU a partir de Excel
    const excelInputSDU = document.getElementById('sdu-excel-upload');
    const gerarSDUButton = document.getElementById('gerar-relatorio-sdu-tabelas');
    if (excelInputSDU && gerarSDUButton) {
      gerarSDUButton.addEventListener('click', async () => {
        const files = excelInputSDU.files;
        if (!files.length) {
          alert("Por favor, selecione pelo menos um arquivo Excel.");
          return;
        }

        const allData = [];
        for (const file of files) {
          const data = await readExcelFile(file);
          if (data) allData.push(...data);
        }

        if (allData.length) {
          try {
            await gerarRelatorioSduPDF(allData);
            alert("Relatório SDU-CENTRO gerado com sucesso!");
          } catch (error) {
            console.error("Erro ao gerar o relatório SDU-CENTRO:", error);
            alert("Ocorreu um erro ao gerar o relatório.");
          }
        }
      });
    } else {
      console.error("Elemento com ID 'sdu-excel-upload' ou 'gerar-relatorio-sdu' não encontrado no DOM.");
    }

    // Evento para o botão Voltar SDU
    const voltarButtonSDU = document.getElementById('retornarSDU');
    if (voltarButtonSDU) {
      voltarButtonSDU.addEventListener('click', () => {
        window.location.href = 'home.html';
      });
    } else {
      console.error("Elemento com ID 'retornarSDU' não encontrado no DOM.");
    }

  };
</script>

</body>
</html>